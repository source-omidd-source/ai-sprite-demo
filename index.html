<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ¨Ø¯ÛŒÙ„ Ù†Ù‚Ø§Ø´ÛŒ Ø¨Ù‡ Ø§Ø³Ù¾Ø±Ø§ÛŒØª (Ø¯Ù…Ùˆ Ù†Ù‡Ø§ÛŒÛŒ)</title>
    <style>
        body { font-family: Tahoma, sans-serif; background: #222; color: white; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: #333; padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .input-group { background: #444; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: right; }
        label { display: block; margin-bottom: 5px; color: #ff9800; font-size: 14px; font-weight: bold; }
        input[type="text"] { width: 95%; padding: 10px; border-radius: 5px; border: none; font-family: sans-serif; }
        input[type="file"] { width: 100%; margin-top: 5px; }

        button { background: #4CAF50; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold; transition: 0.3s; }
        button:disabled { background: #555; cursor: not-allowed; }
        button:hover:not(:disabled) { background: #45a049; transform: scale(1.02); }
        
        .preview-box { display: flex; justify-content: space-around; margin-top: 20px; gap: 10px; }
        .preview-box div { width: 48%; }
        img { width: 100%; border-radius: 10px; border: 2px solid #555; background: #fff; min-height: 150px; object-fit: contain; }
        
        .status { margin-top: 15px; color: #ffeb3b; font-size: 14px; font-weight: bold; min-height: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ® Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ø§Ø³Ù¾Ø±Ø§ÛŒØªâ€ŒØ³Ø§Ø²ÛŒ</h2>
        
        <div class="input-group">
            <label>Û±. Ù†Ù‚Ø§Ø´ÛŒâ€ŒØ§Øª Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†:</label>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="input-group">
            <label>Û². Ú†ÛŒ Ù…ÛŒØ®ÙˆØ§ÛŒØŸ (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ):</label>
            <input type="text" id="prompt" value="Make it a pixel art game sprite, white background" placeholder="Ù…Ø«Ù„Ø§: cyberpunk robot">
        </div>
        
        <button onclick="runAI()" id="btn">ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ¨Ø¯ÛŒÙ„</button>
        <p class="status" id="status">Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹...</p>

        <div class="preview-box">
            <div>
                <p>Ù†Ù‚Ø§Ø´ÛŒ Ø´Ù…Ø§:</p>
                <img id="preview" src="https://via.placeholder.com/200x200?text=Upload+Image">
            </div>
            <div>
                <p>Ø®Ø±ÙˆØ¬ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ:</p>
                <img id="result" src="https://via.placeholder.com/200x200?text=Result">
            </div>
        </div>
    </div>

    <script type="module">
        import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client@0.1.4/dist/index.min.js";

        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø± ØªÙˆØ§Ø¨Ø¹
        window.runAI = async function() {
            const fileInput = document.getElementById('fileInput');
            const promptText = document.getElementById('prompt').value;
            const status = document.getElementById('status');
            const btn = document.getElementById('btn');
            const resultImg = document.getElementById('result');
            const previewImg = document.getElementById('preview');

            // Û±. Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ÛŒ
            if (fileInput.files.length === 0) {
                alert("âŒ Ø§ÙˆÙ„ ÛŒÙ‡ Ø¹Ú©Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†!");
                return;
            }

            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³ Ú©Ø§Ø±Ø¨Ø±
            const userFile = fileInput.files[0];
            previewImg.src = URL.createObjectURL(userFile);

            // Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡
            btn.disabled = true;
            btn.innerText = "â³ Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±...";
            status.innerText = "Ø¯Ø±Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ...";
            status.style.color = "#ffeb3b"; // Ø²Ø±Ø¯

            try {
                // Û². Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø§Ø³Ù¾ÛŒØ³ Ø¹Ù…ÙˆÙ…ÛŒ (Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆÚ©Ù†!)
                // Ù…Ø§ Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Instruct-Pix2Pix ÙˆØµÙ„ Ù…ÛŒâ€ŒØ´ÙˆÛŒÙ…
                const app = await Client.connect("timbrooks/instruct-pix2pix");

                status.innerText = "ğŸ¤– Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø§Ø±Ù‡ Ø±ÙˆØ´ Ú©Ø§Ø± Ù…ÛŒÚ©Ù†Ù‡ (Û±Û°-Û²Û° Ø«Ø§Ù†ÛŒÙ‡)...";

                // Û³. Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
                const result = await app.predict("/predict", [
                    userFile,      // Ø¹Ú©Ø³ ÙˆØ±ÙˆØ¯ÛŒ
                    promptText,    // Ù…ØªÙ† Ø¯Ø³ØªÙˆØ±
                    50,            // ØªØ¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ø­Ù„ (Steps) - Ú©ÛŒÙÛŒØª
                    true,          // Ú¯Ø²ÛŒÙ†Ù‡ Randomize Seed
                    1.5,           // Text Guidance
                    1.5            // Image Guidance
                ]);

                // Û´. Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
                // Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±Ø§Ø¯ÛŒÙˆ Ù…Ø¹Ù…ÙˆÙ„Ø§ Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø³ØªØŒ Ø¹Ú©Ø³ Ø§ÙˆÙ„ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒØ¯Ø§Ø±ÛŒÙ…
                if (result.data && result.data.length > 0) {
                    resultImg.src = result.data[0].url;
                    status.innerText = "âœ… Ø§Ø³Ù¾Ø±Ø§ÛŒØª Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯!";
                    status.style.color = "#4CAF50"; // Ø³Ø¨Ø²
                } else {
                    throw new Error("Ø®Ø±ÙˆØ¬ÛŒ Ø¹Ú©Ø³ Ù†Ø¯Ø§Ø´Øª!");
                }

            } catch (error) {
                console.error(error);
                status.innerText = "âŒ Ø®Ø·Ø§: " + error.message;
                status.style.color = "#ff5555"; // Ù‚Ø±Ù…Ø²
            }

            // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù‚ÙÙ„ Ø¯Ú©Ù…Ù‡
            btn.disabled = false;
            btn.innerText = "ğŸš€ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø³Ø§Ø²";
        };
    </script>
</body>
</html>
