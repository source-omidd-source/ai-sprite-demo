<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ¨Ø¯ÛŒÙ„ Ù†Ù‚Ø§Ø´ÛŒ Ø¨Ù‡ Ø§Ø³Ù¾Ø±Ø§ÛŒØª (Ù†Ø³Ø®Ù‡ Ø¯Ù…Ùˆ)</title>
    <style>
        body { font-family: Tahoma, sans-serif; background: #222; color: white; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: #333; padding: 20px; border-radius: 15px; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ */
        .input-group { background: #444; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: right; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 12px; }
        input[type="text"] { width: 95%; padding: 10px; border-radius: 5px; border: none; font-family: sans-serif; }
        input[type="file"] { width: 100%; margin-top: 5px; }

        /* Ø¯Ú©Ù…Ù‡ Ùˆ Ù†ØªÛŒØ¬Ù‡ */
        button { background: #ff9800; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold; }
        button:disabled { background: #555; cursor: not-allowed; }
        
        .preview-box { display: flex; justify-content: space-around; margin-top: 20px; }
        .preview-box div { width: 45%; }
        img { max-width: 100%; border-radius: 10px; border: 2px solid #555; background: white; }
        .status { margin-top: 10px; color: #ffeb3b; font-size: 14px; min-height: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ðŸŽ¨ Ù†Ù‚Ø§Ø´ÛŒ Ø¨Ù‡ Ø§Ø³Ù¾Ø±Ø§ÛŒØª Ú¯ÛŒÙ…</h2>
        
        <div class="input-group">
            <label>Û±. Ù†Ù‚Ø§Ø´ÛŒâ€ŒØ§Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:</label>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="input-group">
            <label>Û². Ø¨Ú¯Ùˆ Ú†ÛŒ Ø¨Ø´Ù‡ (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ):</label>
            <input type="text" id="prompt" value="Turn this into a pixel art sprite sheet game asset" placeholder="Ù…Ø«Ù„Ø§: Make it a cyberpunk robot">
        </div>
        
        <button onclick="processImage()" id="btn">âœ¨ Ø¬Ø§Ø¯Ùˆ Ú©Ù†!</button>
        <p class="status" id="status"></p>

        <div class="preview-box">
            <div>
                <p>Ù†Ù‚Ø§Ø´ÛŒ Ø´Ù…Ø§:</p>
                <img id="preview" src="https://via.placeholder.com/150?text=Upload" style="opacity: 0.5;">
            </div>
            <div>
                <p>Ù†ØªÛŒØ¬Ù‡:</p>
                <img id="result" src="https://via.placeholder.com/150?text=Result" style="display: none;">
            </div>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        // ðŸ‘‡ðŸ‘‡ðŸ‘‡ ØªÙˆÚ©Ù† Ø®ÙˆØ¯Øª Ø±Ùˆ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø°Ø§Ø± ðŸ‘‡ðŸ‘‡ðŸ‘‡
        const MY_TOKEN = "hf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"; 

        // Ù…Ø¯Ù„ Ù…Ø®ØµÙˆØµ ØªØºÛŒÛŒØ± Ø¹Ú©Ø³ (Instruct Pix2Pix)
        const MODEL_URL = "https://api-inference.huggingface.co/models/timbrooks/instruct-pix2pix";

        async function processImage() {
            const fileInput = document.getElementById('fileInput');
            const promptText = document.getElementById('prompt').value;
            const status = document.getElementById('status');
            const btn = document.getElementById('btn');
            const resultImg = document.getElementById('result');
            const previewImg = document.getElementById('preview');

            // Û±. Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
            if (MY_TOKEN.includes("xxx")) return alert("âŒ ØªÙˆÚ©Ù† Ø±Ùˆ ØªÙˆÛŒ Ú©Ø¯ Ù†Ø°Ø§Ø´ØªÛŒ!");
            if (fileInput.files.length === 0) return alert("âŒ Ø§ÙˆÙ„ ÛŒÙ‡ Ø¹Ú©Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†!");

            btn.disabled = true;
            btn.innerText = "â³ Ø¯Ø§Ø±Ù… Ø¹Ú©Ø³ Ø±Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù…...";
            
            try {
                // Û². ØªØ¨Ø¯ÛŒÙ„ Ùˆ Ú©ÙˆÚ†Ú©â€ŒØ³Ø§Ø²ÛŒ Ø¹Ú©Ø³ (Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø§Ø±ÙˆØ± Ù†Ø¯Ù‡)
                status.innerText = "Ø¯Ø±Ø­Ø§Ù„ ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ú©Ø³...";
                const base64Image = await resizeAndConvert(fileInput.files[0]);
                previewImg.src = base64Image; // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´

                // Û³. Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                status.innerText = "ðŸš€ Ø¯Ø±Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± (Û±Û°-Û²Û° Ø«Ø§Ù†ÛŒÙ‡)...";
                btn.innerText = "ðŸ¤– Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø§Ø±Ù‡ ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡...";

                const response = await fetch(MODEL_URL, {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${MY_TOKEN}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        inputs: promptText, // Ø¯Ø³ØªÙˆØ± Ù…ØªÙ†ÛŒ
                        parameters: {
                            image: base64Image, // Ø¹Ú©Ø³ ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯Ù‡
                            num_inference_steps: 20, // Ú©ÛŒÙÛŒØª
                            image_guidance_scale: 1.5 // Ú†Ù‚Ø¯Ø± Ø¨Ù‡ Ø¹Ú©Ø³ Ø§ØµÙ„ÛŒ ÙˆÙØ§Ø¯Ø§Ø± Ø¨Ø§Ø´Ù‡
                        }
                    })
                });

                if (!response.ok) {
                    const errText = await response.text();
                    throw new Error("Ø®Ø·Ø§ÛŒ Ù…Ø¯Ù„: " + errText);
                }

                // Û´. Ø¯Ø±ÛŒØ§ÙØª Ù†ØªÛŒØ¬Ù‡
                const blob = await response.blob();
                const resultUrl = URL.createObjectURL(blob);
                
                resultImg.src = resultUrl;
                resultImg.style.display = 'block';
                status.innerText = "âœ… Ø§Ø³Ù¾Ø±Ø§ÛŒØª Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯!";

            } catch (error) {
                console.error(error);
                status.innerText = "âŒ Ø®Ø·Ø§! Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ùˆ Ú†Ú© Ú©Ù†.";
                if(error.message.includes("estimated_time")) {
                     status.innerText = "â³ Ù…Ø¯Ù„ Ø¯Ø§Ø±Ù‡ Ú¯Ø±Ù… Ù…ÛŒØ´Ù‡ØŒ Û±Û° Ø«Ø§Ù†ÛŒÙ‡ Ø¯ÛŒÚ¯Ù‡ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø²Ù†!";
                }
            }

            btn.disabled = false;
            btn.innerText = "âœ¨ Ø¬Ø§Ø¯Ùˆ Ú©Ù†!";
        }

        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù† Ø¹Ú©Ø³ (Ú†ÙˆÙ† API Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¹Ú©Ø³ Ø¨Ø²Ø±Ú¯ Ù‚Ø¨ÙˆÙ„ Ù†Ù…ÛŒÚ©Ù†Ù‡)
        function resizeAndConvert(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.getElementById('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // ØªÙ†Ø¸ÛŒÙ… Ø³Ø§ÛŒØ² Ø±ÙˆÛŒ ÛµÛ±Û² Ø¯Ø± ÛµÛ±Û² (Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ)
                        canvas.width = 512;
                        canvas.height = 512;
                        
                        // Ú©Ø´ÛŒØ¯Ù† Ø¹Ú©Ø³ ØªÙˆÛŒ Ú©Ø§Ù†ÙˆØ§Ø³ Ø¨Ø§ Ø³Ø§ÛŒØ² Ø¬Ø¯ÛŒØ¯
                        ctx.drawImage(img, 0, 0, 512, 512);
                        
                        // Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ† Ø¨Ø¯ÙˆÙ† Ù‡Ø¯Ø± (Ú†ÙˆÙ† Ø¨Ø¹Ø¶ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§ Ù‡Ø¯Ø± Ø¯ÙˆØ³Øª Ù†Ø¯Ø§Ø±Ù†Ø¯)
                        // Ø§Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø¯Ù„ Ø®Ø§Øµ Base64 Ú©Ø§Ù…Ù„ Ù…ÛŒâ€ŒÙØ±Ø³ØªÛŒÙ…
                        resolve(canvas.toDataURL("image/jpeg", 0.8)); 
                    };
                };
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html>
